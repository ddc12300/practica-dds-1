---
title: "Actividad Evaluable 1 - Data Driven Security"
author: "Raquel Abad y Daniel Díaz"
date: "11 de enero, 2024"
output: 
  html_document:
    keep_md: true
---

## Data Science

### Pregunta 1: Clasificación de preguntas

**Preguntas proporcionadas:**

1.  Dado un registro de vehículos que circulan por una autopista, disponemos de su marca y modelo, país de matriculación, y tipo de vehículo (por número de ruedas). Con tal de ajustar precios de los peajes, ¿Cuántos vehículos tenemos por tipo? ¿Cuál es el tipo más frecuente? ¿De qué países tenemos más vehículos?

**Descriptiva**: Se busca describir el conjunto de datos en términos de la cantidad de vehículos por tipo, el tipo más frecuente y la procedencia de los vehículos.

2.  Dado un registro de visualizaciones de un servicio de video-on-demand, donde disponemos de los datos del usuario, de la película seleccionada, fecha de visualización y categoría de la película, queremos saber ¿Hay alguna preferencia en cuanto a género literario según los usuarios y su rango de edad?

**Exploratoria**: Se quiere explorar si hay una preferencia de género literario según los usuarios y su rango de edad.

3.  Dado un registro de peticiones a un sitio web, vemos que las peticiones que provienen de una red de telefonía concreta acostumbran a ser incorrectas y provocarnos errores de servicio. ¿Podemos determinar si en el futuro, los próximos mensajes de esa red seguirán dando problemas? ¿Hemos notado el mismo efecto en otras redes de telefonía?

**Predictiva**: Se intenta predecir si las peticiones futuras de una red de telefonía específica continuarán causando errores.

4.  Dado los registros de usuarios de un servicio de compras por internet, los usuarios pueden agruparse por preferencias de productos comprados. Queremos saber si ¿Es posible que, dado un usuario al azar y según su historial, pueda ser directamente asignado a un o diversos grupos?

**Inferencial**: Se busca inferir si un usuario puede ser asignado a un grupo basado en su historial de compras.

### Pregunta 2: Considera el siguiente escenario:

Sabemos que un usuario de nuestra red empresarial ha estado usando esta para fines no relacionados con el trabajo, como por ejemplo tener un servicio web no autorizado abierto a la red (otros usuarios tienen servicios web activados y autorizados). No queremos tener que rastrear los puertos de cada PC, y sabemos que la actividad puede haber cesado. Pero podemos acceder a los registros de conexiones TCP de cada máquina de cada trabajador (hacia donde abre conexión un PC concreto). Sabemos que nuestros clientes se conectan desde lugares remotos de forma legítima, como parte de nuestro negocio, y que un trabajador puede haber habilitado temporalmente servicios de prueba. Nuestro objetivo es reducir lo posible la lista de posibles culpables, con tal de explicarles que por favor no expongan nuestros sistemas sin permiso de los operadores o la dirección.

Para abordar el escenario propuesto mediante Data Science, se seguiría un proceso estructurado que comprende la obtención y tratamiento de datos, análisis exploratorio, identificación de patrones, visualización y comunicación de resultados. A continuación se detallan los pasos del proceso de forma concisa y en tercera persona:

### 1. Obtención de Datos

Como punto de partida, se usarían los registros de conexiones TCP de las computadoras de los empleados. Estos registros incluirían detalles como las direcciones IP, los puertos y las marcas de tiempo, que son clave para el análisis.

### 2. Tratamiento de Datos

Antes de analizar los datos, sería necesario limpiarlos para quitar cualquier información irrelevante o incorrecta. Esto implicaría eliminar datos duplicados y normalizar los formatos de las direcciones IP y los puertos.

### 3. Análisis Exploratorio

El siguiente paso sería echar un vistazo general a los datos para entender qué está pasando. Se calcularían algunas estadísticas básicas y se observaría cómo se distribuyen las conexiones a lo largo del tiempo para detectar cualquier cosa fuera de lo común.

### 4. Identificación de Patrones

Para encontrar pistas sobre los servicios web no autorizados, se aplicarían métodos como el agrupamiento de datos (clustering) y la detección de anomalías. La idea sería buscar cualquier patrón de conexión que no encaje con lo que se espera de un uso normal.

### 5. Visualización de Datos

Para hacer más fácil la interpretación de los datos, se crearían gráficos como mapas de calor o gráficos de red. Estas visualizaciones ayudarían a ver mejor los patrones y a explicar los hallazgos a otras personas.

### 6. Comunicación de Resultados

Al final, se prepararía un informe o una presentación con los resultados del análisis. Se usarían las visualizaciones para hacer que la información sea más accesible y se explicaría lo que se encontró de manera clara y sencilla.

##2. Introducción a R

###Pregunta 1: Una vez cargado el Dataset a analizar, comprobando que se cargan las IPs, el Timestamp, la Petición (Tipo, URL y Protocolo), Código de respuesta, y Bytes de reply. Para importar el data frame usando el delimitador espacio

```{r dataset}
library(readr)

data <- read_table("epa-http.csv", col_names = FALSE)
colnames(data) <- c("IP", "Timestamp", "Tipo", "URL", "Protocolo", "Respuesta", "Bytes" )
View(data)
```

1.  Cuales son las dimensiones del dataset cargado (número de filas y columnas)

```{r dimensiones}
# Número de filas
num_filas <- nrow(data)
print(paste("Número de filas:", num_filas))

# Número de columnas
num_columnas <- ncol(data)
print(paste("Número de columnas:", num_columnas))
```

2.  Valor medio de la columna Bytes

```{r valor-medio-bytes}
# Asumiendo que la séptima columna corresponde a los Bytes
data$Bytes <- as.numeric(data$Bytes)
mean_bytes <- mean(data$Bytes, na.rm = TRUE)
paste("El valor medio de la columna Bytes es:", mean_bytes)
```

###Pregunta 2:De las diferentes IPs de origen accediendo al servidor, ¿cuantas pertenecen a una IP claramente educativa (que contenga ".edu")?

```{r ips_educativas}
ips_educativas <- sum(str_detect(data$IP, "\\.edu$"))
paste("El número de dominios educativos identificados son ", ips_educativas)
```

###Pregunta 3:De todas las peticiones recibidas por el servidor cual es la hora en la que hay mayor volumen de peticiones HTTP de tipo "GET"?

```{r hora-mayor-volumen}
# Extraemos la hora del Timestamp asumiendo que el formato es [día:hora:minuto:segundo]
# y que los datos están en la columna 'Timestamp'
data$Hour <- str_extract(data$Timestamp, "(?<=:)[0-9]{2}(?=:)")

# Contamos las peticiones GET por hora
get_requests <- data[data$Tipo == "\"GET", ]
hour_with_most_gets <- which.max(table(get_requests$Hour))

hour_with_most_gets_name <- names(hour_with_most_gets)
paste("La hora con mayor volumen de peticiones GET es:", hour_with_most_gets_name, "con ")
```

###Pregunta 4: De las peticiones hechas por instituciones educativas (.edu), ¿Cuantos bytes en total se han transmitido, en peticiones de descarga de ficheros de texto ".txt"?

```{r bytes-txt-edu}
# Asumiendo que X1 es la columna de IPs y X4 es la columna de URL
data$Bytes <- as.numeric(data$Bytes)
edu_requests <- data[str_detect(data$IP, "\\.edu$") & str_detect(data$URL, "\\.txt$"), ]
total_bytes_txt_edu <- sum(edu_requests$Bytes, na.rm = TRUE)
paste("Total de bytes transmitidos en peticiones .txt por .edu:", total_bytes_txt_edu)
```

###Pregunta 5: Si separamos la petición en 3 partes (Tipo, URL, Protocolo), usando str_split y el separador " " (espacio), ¿cuantas peticiones buscan directamente la URL = "/"?

```{r num-peticiones-slash}

num_peticiones_slash <- sum(data$URL == "/", na.rm = TRUE)

paste("Total de peticiones a la URL '/':", num_peticiones_slash)
```

###Pregunta 6: Aprovechando que hemos separado la petición en 3 partes (Tipo, URL, Protocolo) ¿Cuantas peticiones NO tienen como protocolo "HTTP/0.2"?

```{r num-peticiones-no-https2.0}

num_peticiones_no_http <- sum(data$Protocolo != "HTTP/0.2\"")

paste("Total de peticiones que no son con el protocolo HTTP/0.2:", num_peticiones_no_http)
```

